{"version":3,"names":["isSupported","navigator","waitForServiceWorker","Promise","resolve","reject","Error","serviceWorker","controller","addEventListener","_ready","_classPrivateFieldLooseKey","ServiceWorkerStore","constructor","opts","Object","defineProperty","writable","value","_classPrivateFieldLooseBase","then","val","name","storeName","ready","list","onMessage","event","data","store","type","files","removeEventListener","postMessage","put","file","delete","fileID"],"sources":["ServiceWorkerStore.js"],"sourcesContent":["const isSupported = typeof navigator !== 'undefined' && 'serviceWorker' in navigator\n\nfunction waitForServiceWorker () {\n  return new Promise((resolve, reject) => {\n    if (!isSupported) {\n      reject(new Error('Unsupported'))\n    } else if (navigator.serviceWorker.controller) {\n      // A serviceWorker is already registered and active.\n      resolve()\n    } else {\n      navigator.serviceWorker.addEventListener('controllerchange', () => {\n        resolve()\n      })\n    }\n  })\n}\n\nclass ServiceWorkerStore {\n  #ready\n\n  constructor (opts) {\n    this.#ready = waitForServiceWorker().then((val) => { this.#ready = val })\n    this.name = opts.storeName\n  }\n\n  get ready () {\n    return Promise.resolve(this.#ready)\n  }\n\n  // TODO: remove this setter in the next major\n  set ready (val) {\n    this.#ready = val\n  }\n\n  async list () {\n    await this.#ready\n\n    return new Promise((resolve, reject) => {\n      const onMessage = (event) => {\n        if (event.data.store !== this.name) {\n          return\n        }\n        switch (event.data.type) {\n          case 'uppy/ALL_FILES':\n            resolve(event.data.files)\n            navigator.serviceWorker.removeEventListener('message', onMessage)\n            break\n          default:\n            reject()\n        }\n      }\n\n      navigator.serviceWorker.addEventListener('message', onMessage)\n\n      navigator.serviceWorker.controller.postMessage({\n        type: 'uppy/GET_FILES',\n        store: this.name,\n      })\n    })\n  }\n\n  async put (file) {\n    await this.#ready\n    navigator.serviceWorker.controller.postMessage({\n      type: 'uppy/ADD_FILE',\n      store: this.name,\n      file,\n    })\n  }\n\n  async delete (fileID) {\n    await this.#ready\n    navigator.serviceWorker.controller.postMessage({\n      type: 'uppy/REMOVE_FILE',\n      store: this.name,\n      fileID,\n    })\n  }\n}\n\nServiceWorkerStore.isSupported = isSupported\n\nexport default ServiceWorkerStore\n"],"mappings":"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"}