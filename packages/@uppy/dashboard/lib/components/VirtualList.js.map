{"version":3,"sources":["VirtualList.js"],"names":["h","Component","require","STYLE_INNER","position","width","minHeight","STYLE_CONTENT","top","left","overflow","VirtualList","constructor","props","handleScroll","setState","offset","base","scrollTop","handleResize","resize","focusElement","state","height","componentDidMount","window","addEventListener","componentWillUpdate","contains","document","activeElement","componentDidUpdate","parentNode","focus","componentWillUnmount","removeEventListener","offsetHeight","render","data","rowHeight","renderRow","overscanCount","start","Math","floor","visibleRowCount","max","end","selection","slice","styleInner","length","styleContent","map","module","exports"],"mappings":"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","sourcesContent":["/**\r\n * Adapted from preact-virtual-list: https://github.com/developit/preact-virtual-list\r\n *\r\n * Â© 2016 Jason Miller\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n *\r\n * Adaptations:\r\n * - Added role=presentation to helper elements\r\n * - Tweaked styles for Uppy's Dashboard use case\r\n */\r\n\r\nconst { h, Component } = require('preact')\r\n\r\nconst STYLE_INNER = {\r\n  position: 'relative',\r\n  // Disabled for our use case: the wrapper elements around FileList already deal with overflow,\r\n  // and this additional property would hide things that we want to show.\r\n  //\r\n  // overflow: 'hidden',\r\n  width: '100%',\r\n  minHeight: '100%',\r\n}\r\n\r\nconst STYLE_CONTENT = {\r\n  position: 'absolute',\r\n  top: 0,\r\n  left: 0,\r\n  // Because the `top` value gets set to some offset, this `height` being 100% would make the scrollbar\r\n  // stretch far beyond the content. For our use case, the content div actually can get its height from\r\n  // the elements inside it, so we don't need to specify a `height` property at all.\r\n  //\r\n  // height: '100%',\r\n  width: '100%',\r\n  overflow: 'visible',\r\n}\r\n\r\nclass VirtualList extends Component {\r\n  constructor (props) {\r\n    super(props)\r\n\r\n    // The currently focused node, used to retain focus when the visible rows change.\r\n    // To avoid update loops, this should not cause state updates, so it's kept as a plain property.\r\n    this.focusElement = null\r\n\r\n    this.state = {\r\n      offset: 0,\r\n      height: 0,\r\n    }\r\n  }\r\n\r\n  componentDidMount () {\r\n    this.resize()\r\n    window.addEventListener('resize', this.handleResize)\r\n  }\r\n\r\n  // TODO: refactor to stable lifecycle method\r\n  // eslint-disable-next-line\r\n  componentWillUpdate () {\r\n    if (this.base.contains(document.activeElement)) {\r\n      this.focusElement = document.activeElement\r\n    }\r\n  }\r\n\r\n  componentDidUpdate () {\r\n    // Maintain focus when rows are added and removed.\r\n    if (this.focusElement && this.focusElement.parentNode\r\n        && document.activeElement !== this.focusElement) {\r\n      this.focusElement.focus()\r\n    }\r\n    this.focusElement = null\r\n    this.resize()\r\n  }\r\n\r\n  componentWillUnmount () {\r\n    window.removeEventListener('resize', this.handleResize)\r\n  }\r\n\r\n  handleScroll = () => {\r\n    this.setState({ offset: this.base.scrollTop })\r\n  }\r\n\r\n  handleResize = () => {\r\n    this.resize()\r\n  }\r\n\r\n  resize () {\r\n    const { height } = this.state\r\n\r\n    if (height !== this.base.offsetHeight) {\r\n      this.setState({\r\n        height: this.base.offsetHeight,\r\n      })\r\n    }\r\n  }\r\n\r\n  render ({\r\n    data,\r\n    rowHeight,\r\n    renderRow,\r\n    overscanCount = 10,\r\n    ...props\r\n  }) {\r\n    const { offset, height } = this.state\r\n    // first visible row index\r\n    let start = Math.floor(offset / rowHeight)\r\n\r\n    // actual number of visible rows (without overscan)\r\n    let visibleRowCount = Math.floor(height / rowHeight)\r\n\r\n    // Overscan: render blocks of rows modulo an overscan row count\r\n    // This dramatically reduces DOM writes during scrolling\r\n    if (overscanCount) {\r\n      start = Math.max(0, start - (start % overscanCount))\r\n      visibleRowCount += overscanCount\r\n    }\r\n\r\n    // last visible + overscan row index + padding to allow keyboard focus to travel past the visible area\r\n    const end = start + visibleRowCount + 4\r\n\r\n    // data slice currently in viewport plus overscan items\r\n    const selection = data.slice(start, end)\r\n\r\n    const styleInner = { ...STYLE_INNER, height: data.length * rowHeight }\r\n    const styleContent = { ...STYLE_CONTENT, top: start * rowHeight }\r\n\r\n    // The `role=\"presentation\"` attributes ensure that these wrapper elements are not treated as list\r\n    // items by accessibility and outline tools.\r\n    return (\r\n      <div onScroll={this.handleScroll} {...props}>\r\n        <div role=\"presentation\" style={styleInner}>\r\n          <div role=\"presentation\" style={styleContent}>\r\n            {selection.map(renderRow)}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nmodule.exports = VirtualList\r\n"]}