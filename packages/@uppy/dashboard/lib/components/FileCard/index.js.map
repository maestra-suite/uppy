{"version":3,"sources":["index.js"],"names":["h","Component","require","classNames","nanoid","getFileTypeIcon","ignoreEvent","FilePreview","FileCard","constructor","props","form","document","createElement","updateMeta","newVal","name","setState","formState","handleSave","e","preventDefault","fileID","fileCardFor","saveFileCard","state","handleCancel","toggleFileCard","saveOnEnter","ev","keyCode","stopPropagation","file","files","id","renderMetaFields","metaFields","getMetaFields","fieldCSSClasses","text","map","field","required","requiredMetaFields","includes","render","undefined","value","onChange","type","placeholder","HTMLInputElement","prototype","target","storedMetaData","forEach","meta","componentWillMount","addEventListener","body","appendChild","componentWillUnmount","removeEventListener","removeChild","showEditButton","canEditFile","className","i18nArray","i18n","backgroundColor","color","event","openFileEditor","HTMLButtonElement","module","exports"],"mappings":"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","sourcesContent":["const { h, Component } = require('preact')\r\nconst classNames = require('classnames')\r\nconst { nanoid } = require('nanoid/non-secure')\r\nconst getFileTypeIcon = require('../../utils/getFileTypeIcon')\r\nconst ignoreEvent = require('../../utils/ignoreEvent.js')\r\nconst FilePreview = require('../FilePreview')\r\n\r\nclass FileCard extends Component {\r\n  form = document.createElement('form')\r\n\r\n  constructor (props) {\r\n    super(props)\r\n\r\n    const file = this.props.files[this.props.fileCardFor]\r\n    const metaFields = this.getMetaFields() || []\r\n\r\n    const storedMetaData = {}\r\n    metaFields.forEach((field) => {\r\n      storedMetaData[field.id] = file.meta[field.id] || ''\r\n    })\r\n\r\n    this.state = {\r\n      formState: storedMetaData,\r\n    }\r\n\r\n    this.form.id = nanoid()\r\n  }\r\n\r\n  // TODO(aduh95): move this to `UNSAFE_componentWillMount` when updating to Preact X+.\r\n  componentWillMount () { // eslint-disable-line react/no-deprecated\r\n    this.form.addEventListener('submit', this.handleSave)\r\n    document.body.appendChild(this.form)\r\n  }\r\n\r\n  componentWillUnmount () {\r\n    this.form.removeEventListener('submit', this.handleSave)\r\n    document.body.removeChild(this.form)\r\n  }\r\n\r\n  getMetaFields () {\r\n    return typeof this.props.metaFields === 'function'\r\n      ? this.props.metaFields(this.props.files[this.props.fileCardFor])\r\n      : this.props.metaFields\r\n  }\r\n\r\n  updateMeta = (newVal, name) => {\r\n    this.setState(({ formState }) => ({\r\n      formState: {\r\n        ...formState,\r\n        [name]: newVal,\r\n      },\r\n    }))\r\n  }\r\n\r\n  handleSave = (e) => {\r\n    e.preventDefault()\r\n    const fileID = this.props.fileCardFor\r\n    this.props.saveFileCard(this.state.formState, fileID)\r\n  }\r\n\r\n  handleCancel = () => {\r\n    this.props.toggleFileCard(false)\r\n  }\r\n\r\n  saveOnEnter = (ev) => {\r\n    if (ev.keyCode === 13) {\r\n      ev.stopPropagation()\r\n      ev.preventDefault()\r\n      const file = this.props.files[this.props.fileCardFor]\r\n      this.props.saveFileCard(this.state.formState, file.id)\r\n    }\r\n  }\r\n\r\n  renderMetaFields = () => {\r\n    const metaFields = this.getMetaFields() || []\r\n    const fieldCSSClasses = {\r\n      text: 'uppy-u-reset uppy-c-textInput uppy-Dashboard-FileCard-input',\r\n    }\r\n\r\n    return metaFields.map((field) => {\r\n      const id = `uppy-Dashboard-FileCard-input-${field.id}`\r\n      const required = this.props.requiredMetaFields.includes(field.id)\r\n      return (\r\n        <fieldset key={field.id} className=\"uppy-Dashboard-FileCard-fieldset\">\r\n          <label className=\"uppy-Dashboard-FileCard-label\" htmlFor={id}>{field.name}</label>\r\n          {field.render !== undefined\r\n            ? field.render({\r\n              value: this.state.formState[field.id],\r\n              onChange: (newVal) => this.updateMeta(newVal, field.id),\r\n              fieldCSSClasses,\r\n              required,\r\n              form: this.form.id,\r\n            }, h)\r\n            : (\r\n              <input\r\n                className={fieldCSSClasses.text}\r\n                id={id}\r\n                form={this.form.id}\r\n                type={field.type || 'text'}\r\n                required={required}\r\n                value={this.state.formState[field.id]}\r\n                placeholder={field.placeholder}\r\n                // If `form` attribute is not supported, we need to capture pressing Enter to avoid bubbling in case Uppy is\r\n                // embedded inside a <form>.\r\n                onKeyUp={'form' in HTMLInputElement.prototype ? undefined : this.saveOnEnter}\r\n                onKeyDown={'form' in HTMLInputElement.prototype ? undefined : this.saveOnEnter}\r\n                onKeyPress={'form' in HTMLInputElement.prototype ? undefined : this.saveOnEnter}\r\n                onInput={ev => this.updateMeta(ev.target.value, field.id)}\r\n                data-uppy-super-focusable\r\n              />\r\n            )}\r\n        </fieldset>\r\n      )\r\n    })\r\n  }\r\n\r\n  render () {\r\n    const file = this.props.files[this.props.fileCardFor]\r\n    const showEditButton = this.props.canEditFile(file)\r\n\r\n    return (\r\n      <div\r\n        className={classNames('uppy-Dashboard-FileCard', this.props.className)}\r\n        data-uppy-panelType=\"FileCard\"\r\n        onDragOver={ignoreEvent}\r\n        onDragLeave={ignoreEvent}\r\n        onDrop={ignoreEvent}\r\n        onPaste={ignoreEvent}\r\n      >\r\n        <div className=\"uppy-DashboardContent-bar\">\r\n          <div className=\"uppy-DashboardContent-title\" role=\"heading\" aria-level=\"1\">\r\n            {this.props.i18nArray('editing', {\r\n              file: <span className=\"uppy-DashboardContent-titleFile\">{file.meta ? file.meta.name : file.name}</span>,\r\n            })}\r\n          </div>\r\n          <button\r\n            className=\"uppy-DashboardContent-back\"\r\n            type=\"button\"\r\n            form={this.form.id}\r\n            title={this.props.i18n('finishEditingFile')}\r\n            onClick={this.handleCancel}\r\n          >\r\n            {this.props.i18n('cancel')}\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"uppy-Dashboard-FileCard-inner\">\r\n          <div className=\"uppy-Dashboard-FileCard-preview\" style={{ backgroundColor: getFileTypeIcon(file.type).color }}>\r\n            <FilePreview file={file} />\r\n            {showEditButton\r\n              && (\r\n              <button\r\n                type=\"button\"\r\n                className=\"uppy-u-reset uppy-c-btn uppy-Dashboard-FileCard-edit\"\r\n                onClick={(event) => {\r\n                  // When opening the image editor we want to save any meta fields changes.\r\n                  // Otherwise it's confusing for the user to click save in the editor,\r\n                  // but the changes here are discarded. This bypasses validation,\r\n                  // but we are okay with that.\r\n                  this.handleSave(event)\r\n                  this.props.openFileEditor(file)\r\n                }}\r\n                form={this.form.id}\r\n              >\r\n                {this.props.i18n('editFile')}\r\n              </button>\r\n              )}\r\n          </div>\r\n\r\n          <div className=\"uppy-Dashboard-FileCard-info\">\r\n            {this.renderMetaFields()}\r\n          </div>\r\n\r\n          <div className=\"uppy-Dashboard-FileCard-actions\">\r\n            <button\r\n              className=\"uppy-u-reset uppy-c-btn uppy-c-btn-primary uppy-Dashboard-FileCard-actionsBtn\"\r\n              // If `form` attribute is supported, we want a submit button to trigger the form validation.\r\n              // Otherwise, fallback to a classic button with a onClick event handler.\r\n              type={'form' in HTMLButtonElement.prototype ? 'submit' : 'button'}\r\n              onClick={'form' in HTMLButtonElement.prototype ? undefined : this.handleSave}\r\n              form={this.form.id}\r\n            >\r\n              {this.props.i18n('saveChanges')}\r\n            </button>\r\n            <button\r\n              className=\"uppy-u-reset uppy-c-btn uppy-c-btn-link uppy-Dashboard-FileCard-actionsBtn\"\r\n              type=\"button\"\r\n              onClick={this.handleCancel}\r\n              form={this.form.id}\r\n            >\r\n              {this.props.i18n('cancel')}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nmodule.exports = FileCard\r\n"]}