{"version":3,"sources":["createSuperFocus.js"],"names":["debounce","require","FOCUSABLE_ELEMENTS","getActiveOverlayEl","module","exports","createSuperFocus","lastFocusWasOnSuperFocusableEl","superFocus","dashboardEl","activeOverlayType","overlayEl","isFocusInOverlay","contains","document","activeElement","superFocusableEl","querySelector","focus","preventScroll","firstEl"],"mappings":"AAAA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,iBAAD,CAAxB;;AACA,MAAMC,kBAAkB,GAAGD,OAAO,CAAC,oCAAD,CAAlC;;AACA,MAAME,kBAAkB,GAAGF,OAAO,CAAC,sBAAD,CAAlC;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACAG,MAAM,CAACC,OAAP,GAAiB,SAASC,gBAAT,GAA6B;AAC5C,MAAIC,8BAA8B,GAAG,KAArC;;AAEA,QAAMC,UAAU,GAAG,CAACC,WAAD,EAAcC,iBAAd,KAAoC;AACrD,UAAMC,SAAS,GAAGR,kBAAkB,CAACM,WAAD,EAAcC,iBAAd,CAApC;AAEA,UAAME,gBAAgB,GAAGD,SAAS,CAACE,QAAV,CAAmBC,QAAQ,CAACC,aAA5B,CAAzB,CAHqD,CAIrD;AACA;AACA;;AACA,QAAIH,gBAAgB,IAAIL,8BAAxB,EAAwD;AAExD,UAAMS,gBAAgB,GAAGL,SAAS,CAACM,aAAV,CAAwB,6BAAxB,CAAzB,CATqD,CAUrD;AACA;AACA;;AACA,QAAIL,gBAAgB,IAAI,CAACI,gBAAzB,EAA2C;;AAE3C,QAAIA,gBAAJ,EAAsB;AACpBA,MAAAA,gBAAgB,CAACE,KAAjB,CAAuB;AAAEC,QAAAA,aAAa,EAAE;AAAjB,OAAvB;AACAZ,MAAAA,8BAA8B,GAAG,IAAjC;AACD,KAHD,MAGO;AACL,YAAMa,OAAO,GAAGT,SAAS,CAACM,aAAV,CAAwBf,kBAAxB,CAAhB;AACAkB,MAAAA,OAAO,QAAP,YAAAA,OAAO,CAAEF,KAAT,CAAe;AAAEC,QAAAA,aAAa,EAAE;AAAjB,OAAf;AACAZ,MAAAA,8BAA8B,GAAG,KAAjC;AACD;AACF,GAvBD,CAH4C,CA4B5C;AACA;AACA;AACA;AACA;AACA;;;AACA,SAAOP,QAAQ,CAACQ,UAAD,EAAa,GAAb,CAAf;AACD,CAnCD","sourcesContent":["const debounce = require('lodash.debounce')\r\nconst FOCUSABLE_ELEMENTS = require('@uppy/utils/lib/FOCUSABLE_ELEMENTS')\r\nconst getActiveOverlayEl = require('./getActiveOverlayEl')\r\n\r\n/*\r\n  Focuses on some element in the currently topmost overlay.\r\n\r\n  1. If there are some [data-uppy-super-focusable] elements rendered already - focuses\r\n     on the first superfocusable element, and leaves focus up to the control of\r\n     a user (until currently focused element disappears from the screen [which\r\n     can happen when overlay changes, or, e.g., when we click on a folder in googledrive]).\r\n  2. If there are no [data-uppy-super-focusable] elements yet (or ever) - focuses\r\n     on the first focusable element, but switches focus if superfocusable elements appear on next render.\r\n*/\r\nmodule.exports = function createSuperFocus () {\r\n  let lastFocusWasOnSuperFocusableEl = false\r\n\r\n  const superFocus = (dashboardEl, activeOverlayType) => {\r\n    const overlayEl = getActiveOverlayEl(dashboardEl, activeOverlayType)\r\n\r\n    const isFocusInOverlay = overlayEl.contains(document.activeElement)\r\n    // If focus is already in the topmost overlay, AND on last update we focused on the superfocusable\r\n    // element - then leave focus up to the user.\r\n    // [Practical check] without this line, typing in the search input in googledrive overlay won't work.\r\n    if (isFocusInOverlay && lastFocusWasOnSuperFocusableEl) return\r\n\r\n    const superFocusableEl = overlayEl.querySelector('[data-uppy-super-focusable]')\r\n    // If we are already in the topmost overlay, AND there are no super focusable elements yet, - leave focus up to the user.\r\n    // [Practical check] without this line, if you are in an empty folder in google drive, and something's uploading in the\r\n    // bg, - focus will be jumping to Done all the time.\r\n    if (isFocusInOverlay && !superFocusableEl) return\r\n\r\n    if (superFocusableEl) {\r\n      superFocusableEl.focus({ preventScroll: true })\r\n      lastFocusWasOnSuperFocusableEl = true\r\n    } else {\r\n      const firstEl = overlayEl.querySelector(FOCUSABLE_ELEMENTS)\r\n      firstEl?.focus({ preventScroll: true })\r\n      lastFocusWasOnSuperFocusableEl = false\r\n    }\r\n  }\r\n\r\n  // ___Why do we need to debounce?\r\n  //    1. To deal with animations: overlay changes via animations, which results in the DOM updating AFTER plugin.update()\r\n  //       already executed.\r\n  //    [Practical check] without debounce, if we open the Url overlay, and click 'Done', Dashboard won't get focused again.\r\n  //    [Practical check] if we delay 250ms instead of 260ms - IE11 won't get focused in same situation.\r\n  //    2. Performance: there can be many state update()s in a second, and this function is called every time.\r\n  return debounce(superFocus, 260)\r\n}\r\n"]}