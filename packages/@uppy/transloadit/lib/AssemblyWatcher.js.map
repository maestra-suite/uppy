{"version":3,"names":["Emitter","_assemblyIDs","_classPrivateFieldLooseKey","_reject","_remaining","_resolve","_uppy","_watching","_onAssemblyComplete","_onAssemblyCancel","_onAssemblyError","_onImportError","_checkAllComplete","_removeListeners","_addListeners","TransloaditAssemblyWatcher","constructor","uppy","assemblyIDs","Object","defineProperty","value","_addListeners2","_removeListeners2","_checkAllComplete2","_watching2","writable","assembly","_classPrivateFieldLooseBase","assembly_id","log","emit","error","fileID","length","promise","Promise","resolve","reject","id","indexOf","off","on"],"sources":["AssemblyWatcher.js"],"sourcesContent":["import Emitter from 'component-emitter'\n\n/**\n * Track completion of multiple assemblies.\n *\n * Emits 'assembly-complete' when an assembly completes.\n * Emits 'assembly-error' when an assembly fails.\n * Exposes a `.promise` property that resolves when all assemblies have\n * completed (or failed).\n */\nclass TransloaditAssemblyWatcher extends Emitter {\n  #assemblyIDs\n\n  #reject\n\n  #remaining\n\n  #resolve\n\n  #uppy\n\n  constructor (uppy, assemblyIDs) {\n    super()\n\n    this.#uppy = uppy\n    this.#assemblyIDs = assemblyIDs\n    this.#remaining = assemblyIDs.length\n\n    this.promise = new Promise((resolve, reject) => {\n      this.#resolve = resolve\n      this.#reject = reject\n    })\n\n    this.#addListeners()\n  }\n\n  /**\n   * Are we watching this assembly ID?\n   */\n  #watching (id) {\n    return this.#assemblyIDs.indexOf(id) !== -1\n  }\n\n  #onAssemblyComplete = (assembly) => {\n    if (!this.#watching(assembly.assembly_id)) {\n      return\n    }\n\n    this.#uppy.log(`[Transloadit] AssemblyWatcher: Got Assembly finish ${assembly.assembly_id}`)\n\n    this.emit('assembly-complete', assembly.assembly_id)\n\n    this.#checkAllComplete()\n  }\n\n  #onAssemblyCancel = (assembly) => {\n    if (!this.#watching(assembly.assembly_id)) {\n      return\n    }\n\n    this.#checkAllComplete()\n  }\n\n  #onAssemblyError = (assembly, error) => {\n    if (!this.#watching(assembly.assembly_id)) {\n      return\n    }\n\n    this.#uppy.log(`[Transloadit] AssemblyWatcher: Got Assembly error ${assembly.assembly_id}`)\n    this.#uppy.log(error)\n\n    this.emit('assembly-error', assembly.assembly_id, error)\n\n    this.#checkAllComplete()\n  }\n\n  #onImportError = (assembly, fileID, error) => {\n    if (!this.#watching(assembly.assembly_id)) {\n      return\n    }\n\n    // Not sure if we should be doing something when it's just one file failing.\n    // ATM, the only options are 1) ignoring or 2) failing the entire upload.\n    // I think failing the upload is better than silently ignoring.\n    // In the future we should maybe have a way to resolve uploads with some failures,\n    // like returning an object with `{ successful, failed }` uploads.\n    this.#onAssemblyError(assembly, error)\n  }\n\n  #checkAllComplete () {\n    this.#remaining -= 1\n    if (this.#remaining === 0) {\n      // We're done, these listeners can be removed\n      this.#removeListeners()\n      this.#resolve()\n    }\n  }\n\n  #removeListeners () {\n    this.#uppy.off('transloadit:complete', this.#onAssemblyComplete)\n    this.#uppy.off('transloadit:assembly-cancel', this.#onAssemblyCancel)\n    this.#uppy.off('transloadit:assembly-error', this.#onAssemblyError)\n    this.#uppy.off('transloadit:import-error', this.#onImportError)\n  }\n\n  #addListeners () {\n    this.#uppy.on('transloadit:complete', this.#onAssemblyComplete)\n    this.#uppy.on('transloadit:assembly-cancel', this.#onAssemblyCancel)\n    this.#uppy.on('transloadit:assembly-error', this.#onAssemblyError)\n    this.#uppy.on('transloadit:import-error', this.#onImportError)\n  }\n}\n\nexport default TransloaditAssemblyWatcher\n"],"mappings":"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"}