{"version":3,"names":["h","UIPlugin","RequestClient","toArray","UrlUI","forEachDroppedOrPastedUrl","packageJson","locale","getYouTubeID","require","getYoutubeTitle","UrlIcon","focusable","width","height","viewBox","d","fill","addProtocolToURL","url","protocolRegex","defaultProtocol","test","canHandleRootDrop","e","items","dataTransfer","urls","filter","item","kind","type","length","checkIfCorrectURL","protocol","match","getFileNameFromUrl","Promise","resolve","reject","id","fuzzy","err","title","pathname","URL","substring","lastIndexOf","Url","constructor","uppy","opts","icon","defaultLocale","defaultOptions","i18nInit","hostname","companionUrl","Error","getMeta","bind","addFile","handleRootDrop","handleRootPaste","client","companionHeaders","companionCookiesRule","post","then","res","error","log","protocollessUrl","optionalMeta","undefined","info","i18n","meta","tagFile","source","name","data","size","isRemote","body","remote","fileId","Object","defineProperty","value","enumerable","isRestriction","message","details","clipboardData","render","install","target","mount","uninstall","unmount","VERSION","version","prototype"],"sources":["Url.jsx"],"sourcesContent":["import { h } from 'preact'\nimport { UIPlugin } from '@uppy/core'\nimport { RequestClient } from '@uppy/companion-client'\nimport toArray from '@uppy/utils/lib/toArray'\nimport UrlUI from './UrlUI.jsx'\nimport forEachDroppedOrPastedUrl from './utils/forEachDroppedOrPastedUrl.js'\n\nimport packageJson from '../package.json'\nimport locale from './locale.js'\nconst getYouTubeID = require('get-youtube-id');\nconst getYoutubeTitle  = require('get-youtube-title');\n\nfunction UrlIcon () {\n  return (\n    <svg aria-hidden=\"true\" focusable=\"false\" width=\"32\" height=\"32\" viewBox=\"0 0 32 32\">\n      <path d=\"M23.637 15.312l-2.474 2.464a3.582 3.582 0 01-.577.491c-.907.657-1.897.986-2.968.986a4.925 4.925 0 01-3.959-1.971c-.248-.329-.164-.902.165-1.149.33-.247.907-.164 1.155.164 1.072 1.478 3.133 1.724 4.618.656a.642.642 0 00.33-.328l2.473-2.463c1.238-1.313 1.238-3.366-.082-4.597a3.348 3.348 0 00-4.618 0l-1.402 1.395a.799.799 0 01-1.154 0 .79.79 0 010-1.15l1.402-1.394a4.843 4.843 0 016.843 0c2.062 1.805 2.144 5.007.248 6.896zm-8.081 5.664l-1.402 1.395a3.348 3.348 0 01-4.618 0c-1.319-1.23-1.319-3.365-.082-4.596l2.475-2.464.328-.328c.743-.492 1.567-.739 2.475-.657.906.165 1.648.574 2.143 1.314.248.329.825.411 1.155.165.33-.248.412-.822.165-1.15-.825-1.068-1.98-1.724-3.216-1.888-1.238-.247-2.556.082-3.628.902l-.495.493-2.474 2.464c-1.897 1.969-1.814 5.09.083 6.977.99.904 2.226 1.396 3.463 1.396s2.473-.492 3.463-1.395l1.402-1.396a.79.79 0 000-1.15c-.33-.328-.908-.41-1.237-.082z\" fill=\"#FF753E\" fill-rule=\"nonzero\" />\n    </svg>\n  )\n}\n\nfunction addProtocolToURL (url) {\n  const protocolRegex = /^[a-z0-9]+:\\/\\//\n  const defaultProtocol = 'http://'\n  if (protocolRegex.test(url)) {\n    return url\n  }\n\n  return defaultProtocol + url\n}\n\nfunction canHandleRootDrop (e) {\n  const items = toArray(e.dataTransfer.items)\n  const urls = items.filter((item) => item.kind === 'string'\n    && item.type === 'text/uri-list')\n  return urls.length > 0\n}\n\nfunction checkIfCorrectURL (url) {\n  if (!url) return false\n\n  const protocol = url.match(/^([a-z0-9]+):\\/\\//)[1]\n  if (protocol !== 'http' && protocol !== 'https') {\n    return false\n  }\n\n  return true\n}\n\nasync function getFileNameFromUrl (url) {\n  return new Promise((resolve, reject) => {\n    if (url.match(/(http:|https:)?\\/\\/(www\\.)?(youtube.com|youtu.be)\\/(watch)?(\\?v=)?(\\S+)?/)) {\n      const id = getYouTubeID(url, {fuzzy: false});\n      getYoutubeTitle(id, 'AIzaSyCM3w7SKmg25eRBgh4tmjPpXDWED-iFp9Q', function (err, title) {\n        resolve(title)\n      })\n    }\n    else {\n      const { pathname } = new URL(url)\n      resolve(pathname.substring(pathname.lastIndexOf('/') + 1))\n    }\n  })\n}\n\n/**\n * Url\n *\n */\nexport default class Url extends UIPlugin {\n  static VERSION = packageJson.version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.id = this.opts.id || 'Url'\n    this.title = this.opts.title || 'Link'\n    this.type = 'acquirer'\n    this.icon = () => <UrlIcon />\n\n    // Set default options and locale\n    this.defaultLocale = locale\n\n    const defaultOptions = {}\n\n    this.opts = { ...defaultOptions, ...opts }\n\n    this.i18nInit()\n\n    this.hostname = this.opts.companionUrl\n\n    if (!this.hostname) {\n      throw new Error('Companion hostname is required, please consult https://uppy.io/docs/companion')\n    }\n\n    // Bind all event handlers for referencability\n    this.getMeta = this.getMeta.bind(this)\n    this.addFile = this.addFile.bind(this)\n    this.handleRootDrop = this.handleRootDrop.bind(this)\n    this.handleRootPaste = this.handleRootPaste.bind(this)\n\n    this.client = new RequestClient(uppy, {\n      companionUrl: this.opts.companionUrl,\n      companionHeaders: this.opts.companionHeaders,\n      companionCookiesRule: this.opts.companionCookiesRule,\n    })\n  }\n\n  getMeta (url) {\n    return this.client.post('url/meta', { url })\n      .then((res) => {\n        if (res.error) {\n          this.uppy.log('[URL] Error:')\n          this.uppy.log(res.error)\n          throw new Error('Failed to fetch the file')\n        }\n        return res\n      })\n  }\n\n  async addFile (protocollessUrl, optionalMeta = undefined) {\n    const url = addProtocolToURL(protocollessUrl)\n    if (!checkIfCorrectURL(url)) {\n      this.uppy.log(`[URL] Incorrect URL entered: ${url}`)\n      this.uppy.info(this.i18n('enterCorrectUrl'), 'error', 4000)\n      return undefined\n    }\n\n    try {\n      const meta = await this.getMeta(url)\n\n      const tagFile = {\n        meta: optionalMeta,\n        source: this.id,\n        name: meta.name || await getFileNameFromUrl(url),\n        type: meta.type,\n        data: {\n          size: meta.size,\n        },\n        isRemote: true,\n        body: {\n          url,\n        },\n        remote: {\n          companionUrl: this.opts.companionUrl,\n          url: `${this.hostname}/url/get`,\n          body: {\n            fileId: url,\n            url,\n          },\n        },\n      }\n\n      Object.defineProperty(tagFile.remote, 'requestClient', { value: this.client, enumerable: false })\n\n      this.uppy.log('[Url] Adding remote file')\n      try {\n        return this.uppy.addFile(tagFile)\n      } catch (err) {\n        if (!err.isRestriction) {\n          this.uppy.log(err)\n        }\n        return err\n      }\n    } catch (err) {\n      this.uppy.log(err)\n      this.uppy.info({\n        message: this.i18n('failedToFetch'),\n        details: err,\n      }, 'error', 4000)\n      return err\n    }\n  }\n\n  handleRootDrop (e) {\n    forEachDroppedOrPastedUrl(e.dataTransfer, 'drop', (url) => {\n      this.uppy.log(`[URL] Adding file from dropped url: ${url}`)\n      this.addFile(url)\n    })\n  }\n\n  handleRootPaste (e) {\n    forEachDroppedOrPastedUrl(e.clipboardData, 'paste', (url) => {\n      this.uppy.log(`[URL] Adding file from pasted url: ${url}`)\n      this.addFile(url)\n    })\n  }\n\n  render () {\n    return <UrlUI i18n={this.i18n} addFile={this.addFile} />\n  }\n\n  install () {\n    const { target } = this.opts\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall () {\n    this.unmount()\n  }\n}\n\n// This is defined outside of the class body because it's not using `this`, but\n// we still want it available on the prototype so the Dashboard can access it.\nUrl.prototype.canHandleRootDrop = canHandleRootDrop\n"],"mappings":"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"}