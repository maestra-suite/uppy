{"version":3,"sources":["index.js"],"names":["UIPlugin","require","h","RequestClient","toArray","UrlUI","forEachDroppedOrPastedUrl","locale","UrlIcon","module","exports","Url","constructor","uppy","opts","id","title","type","icon","defaultLocale","defaultOptions","i18nInit","hostname","companionUrl","Error","getMeta","bind","addFile","handleRootDrop","handleRootPaste","client","companionHeaders","companionCookiesRule","getFileNameFromUrl","url","meta","match","name","substring","lastIndexOf","checkIfCorrectURL","protocol","addProtocolToURL","protocolRegex","defaultProtocol","test","post","then","res","error","log","info","i18n","tagFile","source","thumbnail","data","size","isRemote","body","remote","fileId","providerOptions","videoId","err","isRestriction","catch","message","details","canHandleRootDrop","e","items","dataTransfer","urls","filter","item","kind","length","clipboardData","render","install","target","mount","uninstall","unmount","VERSION"],"mappings":"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","sourcesContent":["const { UIPlugin } = require('@uppy/core')\r\nconst { h } = require('preact')\r\nconst { RequestClient } = require('@uppy/companion-client')\r\nconst toArray = require('@uppy/utils/lib/toArray')\r\nconst UrlUI = require('./UrlUI.js')\r\nconst forEachDroppedOrPastedUrl = require('./utils/forEachDroppedOrPastedUrl')\r\n\r\nconst locale = require('./locale')\r\n\r\nfunction UrlIcon () {\r\n  return (\r\n    <svg aria-hidden=\"true\" focusable=\"false\" width=\"32\" height=\"32\" viewBox=\"0 0 32 32\">\r\n      <g fill=\"none\" fillRule=\"evenodd\">\r\n        <rect className=\"uppy-ProviderIconBg\" fill=\"#FF753E\" width=\"32\" height=\"32\" rx=\"16\" />\r\n        <path d=\"M22.788 15.389l-2.199 2.19a3.184 3.184 0 0 1-.513.437c-.806.584-1.686.876-2.638.876a4.378 4.378 0 0 1-3.519-1.752c-.22-.292-.146-.802.147-1.021.293-.22.806-.146 1.026.146.953 1.313 2.785 1.532 4.105.583a.571.571 0 0 0 .293-.292l2.199-2.189c1.1-1.167 1.1-2.992-.073-4.086a2.976 2.976 0 0 0-4.105 0l-1.246 1.24a.71.71 0 0 1-1.026 0 .703.703 0 0 1 0-1.022l1.246-1.24a4.305 4.305 0 0 1 6.083 0c1.833 1.605 1.906 4.451.22 6.13zm-7.183 5.035l-1.246 1.24a2.976 2.976 0 0 1-4.105 0c-1.172-1.094-1.172-2.991-.073-4.086l2.2-2.19.292-.291c.66-.438 1.393-.657 2.2-.584.805.146 1.465.51 1.905 1.168.22.292.733.365 1.026.146.293-.22.367-.73.147-1.022-.733-.949-1.76-1.532-2.859-1.678-1.1-.22-2.272.073-3.225.802l-.44.438-2.199 2.19c-1.686 1.75-1.612 4.524.074 6.202.88.803 1.979 1.241 3.078 1.241 1.1 0 2.199-.438 3.079-1.24l1.246-1.241a.703.703 0 0 0 0-1.022c-.294-.292-.807-.365-1.1-.073z\" fill=\"#FFF\" fillRule=\"nonzero\" />\r\n      </g>\r\n    </svg>\r\n  )\r\n}\r\n\r\n/**\r\n * Url\r\n *\r\n */\r\nmodule.exports = class Url extends UIPlugin {\r\n  static VERSION = require('../package.json').version\r\n\r\n  constructor (uppy, opts) {\r\n    super(uppy, opts)\r\n    this.id = this.opts.id || 'Url'\r\n    this.title = this.opts.title || 'Link'\r\n    this.type = 'acquirer'\r\n    this.icon = () => <UrlIcon />\r\n\r\n    // Set default options and locale\r\n    this.defaultLocale = locale\r\n\r\n    const defaultOptions = {}\r\n\r\n    this.opts = { ...defaultOptions, ...opts }\r\n\r\n    this.i18nInit()\r\n\r\n    this.hostname = this.opts.companionUrl\r\n\r\n    if (!this.hostname) {\r\n      throw new Error('Companion hostname is required, please consult https://uppy.io/docs/companion')\r\n    }\r\n\r\n    // Bind all event handlers for referencability\r\n    this.getMeta = this.getMeta.bind(this)\r\n    this.addFile = this.addFile.bind(this)\r\n    this.handleRootDrop = this.handleRootDrop.bind(this)\r\n    this.handleRootPaste = this.handleRootPaste.bind(this)\r\n\r\n    this.client = new RequestClient(uppy, {\r\n      companionUrl: this.opts.companionUrl,\r\n      companionHeaders: this.opts.companionHeaders,\r\n      companionCookiesRule: this.opts.companionCookiesRule,\r\n    })\r\n  }\r\n\r\n  getFileNameFromUrl (url, meta) {\r\n    if (url.match(/(http:|https:)?\\/\\/(www\\.)?(youtube.com|youtu.be)\\/(watch)?(\\?v=)?(\\S+)?/)) {\r\n      return (meta.name)\r\n    }\r\n    return (url.substring(url.lastIndexOf('/') + 1))\r\n  }\r\n\r\n  checkIfCorrectURL (url) {\r\n    if (!url) return false\r\n\r\n    const protocol = url.match(/^([a-z0-9]+):\\/\\//)[1]\r\n    if (protocol !== 'http' && protocol !== 'https') {\r\n      return false\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  addProtocolToURL (url) {\r\n    const protocolRegex = /^[a-z0-9]+:\\/\\//\r\n    const defaultProtocol = 'http://'\r\n    if (protocolRegex.test(url)) {\r\n      return url\r\n    }\r\n\r\n    return defaultProtocol + url\r\n  }\r\n\r\n  getMeta (url) {\r\n    return this.client.post('url/meta', { url })\r\n      .then((res) => {\r\n        if (res.error) {\r\n          this.uppy.log('[URL] Error:')\r\n          this.uppy.log(res.error)\r\n          throw new Error('Failed to fetch the file')\r\n        }\r\n        return res\r\n      })\r\n  }\r\n\r\n  async addFile (url) {\r\n    url = this.addProtocolToURL(url)\r\n    if (!this.checkIfCorrectURL(url)) {\r\n      this.uppy.log(`[URL] Incorrect URL entered: ${url}`)\r\n      this.uppy.info(this.i18n('enterCorrectUrl'), 'error', 4000)\r\n      return\r\n    }\r\n\r\n    return this.getMeta(url)\r\n      .then((meta) => {\r\n        const tagFile = {\r\n          source: this.id,\r\n          name: this.getFileNameFromUrl(url, meta),\r\n          type: meta.type,\r\n          thumbnail: meta.thumbnail || '',\r\n          data: {\r\n            size: meta.size,\r\n          },\r\n          isRemote: true,\r\n          body: {\r\n            url,\r\n          },\r\n          remote: {\r\n            companionUrl: this.opts.companionUrl,\r\n            url: `${this.hostname}/url/get`,\r\n            body: {\r\n              fileId: url,\r\n              url,\r\n            },\r\n            providerOptions: this.client.opts,\r\n          },\r\n        }\r\n        if (meta.videoId) {\r\n          tagFile.meta = {\r\n            videoId: meta.videoId,\r\n            name: meta.name,\r\n          }\r\n        }\r\n        return tagFile\r\n      })\r\n      .then((tagFile) => {\r\n        this.uppy.log('[Url] Adding remote file')\r\n        try {\r\n          return this.uppy.addFile(tagFile)\r\n        } catch (err) {\r\n          if (!err.isRestriction) {\r\n            this.uppy.log(err)\r\n          }\r\n          return err\r\n        }\r\n      })\r\n      .catch((err) => {\r\n        this.uppy.log(err)\r\n        this.uppy.info({\r\n          message: this.i18n('failedToFetch'),\r\n          details: err,\r\n        }, 'error', 4000)\r\n        return err\r\n      })\r\n  }\r\n\r\n  canHandleRootDrop (e) {\r\n    const items = toArray(e.dataTransfer.items)\r\n    const urls = items.filter((item) => item.kind === 'string'\r\n      && item.type === 'text/uri-list')\r\n    return urls.length > 0\r\n  }\r\n\r\n  handleRootDrop (e) {\r\n    forEachDroppedOrPastedUrl(e.dataTransfer, 'drop', (url) => {\r\n      this.uppy.log(`[URL] Adding file from dropped url: ${url}`)\r\n      this.addFile(url)\r\n    })\r\n  }\r\n\r\n  handleRootPaste (e) {\r\n    forEachDroppedOrPastedUrl(e.clipboardData, 'paste', (url) => {\r\n      this.uppy.log(`[URL] Adding file from pasted url: ${url}`)\r\n      this.addFile(url)\r\n    })\r\n  }\r\n\r\n  render () {\r\n    return <UrlUI i18n={this.i18n} addFile={this.addFile} />\r\n  }\r\n\r\n  install () {\r\n    const { target } = this.opts\r\n    if (target) {\r\n      this.mount(target, this)\r\n    }\r\n  }\r\n\r\n  uninstall () {\r\n    this.unmount()\r\n  }\r\n}\r\n"]}