{"version":3,"names":["BasePlugin","findDOMElement","toArray","getFormData","packageJson","Form","constructor","uppy","opts","type","id","title","defaultOptions","target","resultName","getMetaFromForm","addResultToForm","submitOnSuccess","triggerUploadOnSubmit","handleFormSubmit","bind","handleUploadStart","handleSuccess","result","form","submit","ev","preventDefault","elements","disabledByUppy","forEach","el","isButton","tagName","disabled","push","upload","then","button","err","Promise","reject","catch","log","stack","message","resultInput","querySelector","updatedResult","JSON","parse","value","Array","isArray","stringify","document","createElement","name","appendChild","formMeta","setMeta","install","nodeName","addEventListener","on","uninstall","removeEventListener","off","VERSION","version"],"sources":["index.js"],"sourcesContent":["import BasePlugin from '@uppy/core/lib/BasePlugin.js'\nimport findDOMElement from '@uppy/utils/lib/findDOMElement'\nimport toArray from '@uppy/utils/lib/toArray'\n\nimport getFormData from 'get-form-data'\n\nimport packageJson from '../package.json'\n\n/**\n * Form\n */\nexport default class Form extends BasePlugin {\n  static VERSION = packageJson.version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.type = 'acquirer'\n    this.id = this.opts.id || 'Form'\n    this.title = 'Form'\n\n    // set default options\n    const defaultOptions = {\n      target: null,\n      resultName: 'uppyResult',\n      getMetaFromForm: true,\n      addResultToForm: true,\n      submitOnSuccess: false,\n      triggerUploadOnSubmit: false,\n    }\n\n    // merge default options with the ones set by user\n    this.opts = { ...defaultOptions, ...opts }\n\n    this.handleFormSubmit = this.handleFormSubmit.bind(this)\n    this.handleUploadStart = this.handleUploadStart.bind(this)\n    this.handleSuccess = this.handleSuccess.bind(this)\n    this.addResultToForm = this.addResultToForm.bind(this)\n    this.getMetaFromForm = this.getMetaFromForm.bind(this)\n  }\n\n  handleUploadStart () {\n    if (this.opts.getMetaFromForm) {\n      this.getMetaFromForm()\n    }\n  }\n\n  handleSuccess (result) {\n    if (this.opts.addResultToForm) {\n      this.addResultToForm(result)\n    }\n\n    if (this.opts.submitOnSuccess) {\n      this.form.submit()\n    }\n  }\n\n  handleFormSubmit (ev) {\n    if (this.opts.triggerUploadOnSubmit) {\n      ev.preventDefault()\n      const elements = toArray(ev.target.elements)\n      const disabledByUppy = []\n      elements.forEach((el) => {\n        const isButton = el.tagName === 'BUTTON' || (el.tagName === 'INPUT' && el.type === 'submit')\n        if (isButton && !el.disabled) {\n          el.disabled = true // eslint-disable-line no-param-reassign\n          disabledByUppy.push(el)\n        }\n      })\n      this.uppy.upload().then(() => {\n        disabledByUppy.forEach((button) => {\n          button.disabled = false // eslint-disable-line no-param-reassign\n        })\n      }, (err) => {\n        disabledByUppy.forEach((button) => {\n          button.disabled = false // eslint-disable-line no-param-reassign\n        })\n        return Promise.reject(err)\n      }).catch((err) => {\n        this.uppy.log(err.stack || err.message || err)\n      })\n    }\n  }\n\n  addResultToForm (result) {\n    this.uppy.log('[Form] Adding result to the original form:')\n    this.uppy.log(result)\n\n    let resultInput = this.form.querySelector(`[name=\"${this.opts.resultName}\"]`)\n    if (resultInput) {\n      // Append new result to the previous result array.\n      // If the previous result is empty, or not an array,\n      // set it to an empty array.\n      let updatedResult\n      try {\n        updatedResult = JSON.parse(resultInput.value)\n      } catch (err) {\n        // Nothing, since we check for array below anyway\n      }\n\n      if (!Array.isArray(updatedResult)) {\n        updatedResult = []\n      }\n      updatedResult.push(result)\n      resultInput.value = JSON.stringify(updatedResult)\n      return\n    }\n\n    resultInput = document.createElement('input')\n    resultInput.name = this.opts.resultName\n    resultInput.type = 'hidden'\n    resultInput.value = JSON.stringify([result])\n\n    this.form.appendChild(resultInput)\n  }\n\n  getMetaFromForm () {\n    const formMeta = getFormData(this.form)\n    // We want to exclude meta the the Form plugin itself has added\n    // See https://github.com/transloadit/uppy/issues/1637\n    delete formMeta[this.opts.resultName]\n    this.uppy.setMeta(formMeta)\n  }\n\n  install () {\n    this.form = findDOMElement(this.opts.target)\n    if (!this.form || this.form.nodeName !== 'FORM') {\n      this.uppy.log('Form plugin requires a <form> target element passed in options to operate, none was found', 'error')\n      return\n    }\n\n    this.form.addEventListener('submit', this.handleFormSubmit)\n    this.uppy.on('upload', this.handleUploadStart)\n    this.uppy.on('complete', this.handleSuccess)\n  }\n\n  uninstall () {\n    this.form.removeEventListener('submit', this.handleFormSubmit)\n    this.uppy.off('upload', this.handleUploadStart)\n    this.uppy.off('complete', this.handleSuccess)\n  }\n}\n"],"mappings":"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"}