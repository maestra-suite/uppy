{"version":3,"names":["BasePlugin","RequestClient","EventManager","RateLimitedQueue","filterNonFailedFiles","filterFilesToEmitUploadStarted","createAbortError","MultipartUploader","pausingUploadReason","createSignedURL","packageJson","firebase","require","default","auth","assertServerError","res","error","Error","message","Object","assign","removeMetaProperty","object","name","newFileObject","removeMetadataFromURL","urlString","urlObject","URL","search","hash","href","getExpiry","credentials","expirationDate","Expiration","timeUntilExpiry","Math","floor","Date","now","undefined","getAllowedMetadata","_ref","meta","allowedMetaFields","querify","metaFields","keys","fromEntries","filter","key","map","realKey","value","String","throwIfAborted","signal","aborted","cause","reason","_abortMultipartUpload","_classPrivateFieldLooseKey","_cache","_createMultipartUpload","_fetchSignature","_getUploadParameters","_listParts","_previousRetryDelay","_requests","_retryDelays","_sendCompletionRequest","_setS3MultipartState","_uploadPartBytes","_getFile","_shouldRetry","_nonMultipartUpload","HTTPCommunicationQueue","constructor","requests","options","setS3MultipartState","getFile","defineProperty","_nonMultipartUpload2","_shouldRetry2","writable","WeakMap","_classPrivateFieldLooseBase","setOptions","wrapPromiseFunction","abortMultipartUpload","priority","createMultipartUpload","signPart","listParts","completeMultipartUpload","_options$retryDelays","retryDelays","uploadPartBytes","Infinity","getUploadParameters","getUploadId","file","cachedResult","get","data","promise","abortPromise","abort","delete","addEventListener","once","set","then","result","removeEventListener","abortFileUpload","create","awaitedResult","uploadFile","chunks","length","shouldUseMultipart","uploadId","parts","Promise","all","chunk","i","uploadChunk","abortOn","err","restoreUploadFile","uploadIdAndKey","resumeUploadFile","alreadyUploadedParts","partNumber","alreadyUploadedInfo","find","_ref2","PartNumber","setAsUploaded","ETag","signatureRetryIterator","values","chunkRetryIterator","shouldRetrySignature","next","done","chunkData","getData","onProgress","onComplete","signature","body","timeout","resolve","setTimeout","size","retryDelayIterator","_err$source","status","source","isPaused","limit","rateLimit","navigator","onLine","pause","window","resume","method","url","fields","headers","toUpperCase","formData","FormData","entries","forEach","_ref10","location","_companionCommunicationQueue","_client","_cachedTemporaryCredentials","_getTemporarySecurityCredentials","_setS3MultipartState2","_getFile2","_uploadLocalFile","_getCompanionClientArgs","_upload","_setCompanionHeaders","_setResumableUploadsCapability","_resetResumableCapability","_Symbol$for","Symbol","for","AwsS3Multipart","uppy","opts","_this$opts$rateLimite","_getCompanionClientArgs2","_uploadLocalFile2","_getTemporarySecurityCredentials2","_ref3","cFile","id","setFileState","s3Multipart","fileIDs","files","getFilesByIds","filesFiltered","filesToEmit","emit","promises","isRemote","getQueue","controller","AbortController","removedHandler","removedFile","on","uploadPromise","remote","requestClient","uploadRemoteFile","wrapSyncFunction","off","upload","setCompanionHeaders","companionHeaders","boolean","capabilities","getState","setState","resumableUploads","type","title","defaultOptions","bind","getTemporarySecurityCredentials","prepareUploadParts","_ref4","presignedUrls","number","rateLimitedQueue","uploaders","uploaderEvents","uploaderSockets","newOptions","resetUploaderReferences","fileID","really","remove","close","assertHost","companionUrl","metadata","idToken","currentUser","getIdToken","post","filename","_ref5","encodeURIComponent","_ref6","uploadIdEnc","expires","accountKey","AccessKeyId","accountSecret","SecretAccessKey","sessionToken","SessionToken","bucketName","bucket","Region","region","Key","crypto","randomUUID","_ref7","_ref8","query","URLSearchParams","_ref9","reject","xhr","XMLHttpRequest","open","setRequestHeader","responseType","onabort","cleanup","ev","target","responseText","includes","loaded","lengthComputable","etag","getResponseHeader","console","warn","send","install","addPreProcessor","addUploader","uninstall","removePreProcessor","removeUploader","_this","bytesUploaded","bytesTotal","uploader","onError","log","onSuccess","uploadResp","uploadURL","onPartComplete","part","companionComm","arguments","getChunkSize","eventManager","onFileRemove","removed","onCancelAll","_temp","onFilePause","start","onPauseAll","onResumeAll","protocol","VERSION","version"],"sources":["index.js"],"sourcesContent":["import BasePlugin from '@uppy/core/lib/BasePlugin.js'\nimport { RequestClient } from '@uppy/companion-client'\nimport EventManager from '@uppy/utils/lib/EventManager'\nimport { RateLimitedQueue } from '@uppy/utils/lib/RateLimitedQueue'\nimport { filterNonFailedFiles, filterFilesToEmitUploadStarted } from '@uppy/utils/lib/fileFilters'\nimport { createAbortError } from '@uppy/utils/lib/AbortController'\n\nimport MultipartUploader, { pausingUploadReason } from './MultipartUploader.js'\nimport createSignedURL from './createSignedURL.js'\nimport packageJson from '../package.json'\nconst firebase = require('firebase/compat/app').default\nconst auth = firebase.auth()\n\nfunction assertServerError (res) {\n  if (res && res.error) {\n    const error = new Error(res.message)\n    Object.assign(error, res.error)\n    throw error\n  }\n  return res\n}\n\nfunction removeMetaProperty (object) {\n  if (!object) return false\n  // add more here?\n  const { name, ...newFileObject } = object\n  return newFileObject\n}\n\nfunction removeMetadataFromURL (urlString) {\n  const urlObject = new URL(urlString)\n  urlObject.search = ''\n  urlObject.hash = ''\n  return urlObject.href\n}\n\n/**\n * Computes the expiry time for a request signed with temporary credentials. If\n * no expiration was provided, or an invalid value (e.g. in the past) is\n * provided, undefined is returned. This function assumes the client clock is in\n * sync with the remote server, which is a requirement for the signature to be\n * validated for AWS anyway.\n *\n * @param {import('../types/index.js').AwsS3STSResponse['credentials']} credentials\n * @returns {number | undefined}\n */\nfunction getExpiry (credentials) {\n  const expirationDate = credentials.Expiration\n  if (expirationDate) {\n    const timeUntilExpiry = Math.floor((new Date(expirationDate) - Date.now()) / 1000)\n    if (timeUntilExpiry > 9) {\n      return timeUntilExpiry\n    }\n  }\n  return undefined\n}\n\nfunction getAllowedMetadata ({ meta, allowedMetaFields, querify = false }) {\n  const metaFields = allowedMetaFields ?? Object.keys(meta)\n\n  if (!meta) return {}\n\n  return Object.fromEntries(\n    metaFields\n      .filter(key => meta[key] != null)\n      .map((key) => {\n        const realKey = querify ? `metadata[${key}]` : key\n        const value = String(meta[key])\n        return [realKey, value]\n      }),\n  )\n}\n\nfunction throwIfAborted (signal) {\n  if (signal?.aborted) { throw createAbortError('The operation was aborted', { cause: signal.reason }) }\n}\n\nclass HTTPCommunicationQueue {\n  #abortMultipartUpload\n\n  #cache = new WeakMap()\n\n  #createMultipartUpload\n\n  #fetchSignature\n\n  #getUploadParameters\n\n  #listParts\n\n  #previousRetryDelay\n\n  #requests\n\n  #retryDelays\n\n  #sendCompletionRequest\n\n  #setS3MultipartState\n\n  #uploadPartBytes\n\n  #getFile\n\n  constructor (requests, options, setS3MultipartState, getFile) {\n    this.#requests = requests\n    this.#setS3MultipartState = setS3MultipartState\n    this.#getFile = getFile\n    this.setOptions(options)\n  }\n\n  setOptions (options) {\n    const requests = this.#requests\n\n    if ('abortMultipartUpload' in options) {\n      this.#abortMultipartUpload = requests.wrapPromiseFunction(options.abortMultipartUpload, { priority:1 })\n    }\n    if ('createMultipartUpload' in options) {\n      this.#createMultipartUpload = requests.wrapPromiseFunction(options.createMultipartUpload, { priority:-1 })\n    }\n    if ('signPart' in options) {\n      this.#fetchSignature = requests.wrapPromiseFunction(options.signPart)\n    }\n    if ('listParts' in options) {\n      this.#listParts = requests.wrapPromiseFunction(options.listParts)\n    }\n    if ('completeMultipartUpload' in options) {\n      this.#sendCompletionRequest = requests.wrapPromiseFunction(options.completeMultipartUpload, { priority:1 })\n    }\n    if ('retryDelays' in options) {\n      this.#retryDelays = options.retryDelays ?? []\n    }\n    if ('uploadPartBytes' in options) {\n      this.#uploadPartBytes = requests.wrapPromiseFunction(options.uploadPartBytes, { priority:Infinity })\n    }\n    if ('getUploadParameters' in options) {\n      this.#getUploadParameters = requests.wrapPromiseFunction(options.getUploadParameters)\n    }\n  }\n\n  async #shouldRetry (err, retryDelayIterator) {\n    const requests = this.#requests\n    const status = err?.source?.status\n\n    // TODO: this retry logic is taken out of Tus. We should have a centralized place for retrying,\n    // perhaps the rate limited queue, and dedupe all plugins with that.\n    if (status == null) {\n      return false\n    }\n    if (status === 403 && err.message === 'Request has expired') {\n      if (!requests.isPaused) {\n        // We don't want to exhaust the retryDelayIterator as long as there are\n        // more than one request in parallel, to give slower connection a chance\n        // to catch up with the expiry set in Companion.\n        if (requests.limit === 1 || this.#previousRetryDelay == null) {\n          const next = retryDelayIterator.next()\n          if (next == null || next.done) {\n            return false\n          }\n          // If there are more than 1 request done in parallel, the RLQ limit is\n          // decreased and the failed request is requeued after waiting for a bit.\n          // If there is only one request in parallel, the limit can't be\n          // decreased, so we iterate over `retryDelayIterator` as we do for\n          // other failures.\n          // `#previousRetryDelay` caches the value so we can re-use it next time.\n          this.#previousRetryDelay = next.value\n        }\n        // No need to stop the other requests, we just want to lower the limit.\n        requests.rateLimit(0)\n        await new Promise(resolve => setTimeout(resolve, this.#previousRetryDelay))\n      }\n    } else if (status === 429) {\n      // HTTP 429 Too Many Requests => to avoid the whole download to fail, pause all requests.\n      if (!requests.isPaused) {\n        const next = retryDelayIterator.next()\n        if (next == null || next.done) {\n          return false\n        }\n        requests.rateLimit(next.value)\n      }\n    } else if (status > 400 && status < 500 && status !== 409) {\n      // HTTP 4xx, the server won't send anything, it's doesn't make sense to retry\n      return false\n    } else if (typeof navigator !== 'undefined' && navigator.onLine === false) {\n      // The navigator is offline, let's wait for it to come back online.\n      if (!requests.isPaused) {\n        requests.pause()\n        window.addEventListener('online', () => {\n          requests.resume()\n        }, { once: true })\n      }\n    } else {\n      // Other error code means the request can be retried later.\n      const next = retryDelayIterator.next()\n      if (next == null || next.done) {\n        return false\n      }\n      await new Promise(resolve => setTimeout(resolve, next.value))\n    }\n    return true\n  }\n\n  async getUploadId (file, signal) {\n    let cachedResult\n    // As the cache is updated asynchronously, there could be a race condition\n    // where we just miss a new result so we loop here until we get nothing back,\n    // at which point it's out turn to create a new cache entry.\n    while ((cachedResult = this.#cache.get(file.data)) != null) {\n      try {\n        return await cachedResult\n      } catch {\n        // In case of failure, we want to ignore the cached error.\n        // At this point, either there's a new cached value, or we'll exit the loop a create a new one.\n      }\n    }\n\n    const promise = this.#createMultipartUpload(this.#getFile(file), signal)\n\n    const abortPromise = () => {\n      promise.abort(signal.reason)\n      this.#cache.delete(file.data)\n    }\n    signal.addEventListener('abort', abortPromise, { once: true })\n    this.#cache.set(file.data, promise)\n    promise.then(async (result) => {\n      signal.removeEventListener('abort', abortPromise)\n      this.#setS3MultipartState(file, result)\n      this.#cache.set(file.data, result)\n    }, () => {\n      signal.removeEventListener('abort', abortPromise)\n      this.#cache.delete(file.data)\n    })\n\n    return promise\n  }\n\n  async abortFileUpload (file) {\n    const result = this.#cache.get(file.data)\n    if (result == null) {\n      // If the createMultipartUpload request never was made, we don't\n      // need to send the abortMultipartUpload request.\n      return\n    }\n    // Remove the cache entry right away for follow-up requests do not try to\n    // use the soon-to-be aborted chached values.\n    this.#cache.delete(file.data)\n    this.#setS3MultipartState(file, Object.create(null))\n    let awaitedResult\n    try {\n      awaitedResult = await result\n    } catch {\n      // If the cached result rejects, there's nothing to abort.\n      return\n    }\n    await this.#abortMultipartUpload(this.#getFile(file), awaitedResult)\n  }\n\n  async #nonMultipartUpload (file, chunk, signal) {\n    const {\n      method = 'POST',\n      url,\n      fields,\n      headers,\n    } = await this.#getUploadParameters(this.#getFile(file), { signal }).abortOn(signal)\n\n    let body\n    const data = chunk.getData()\n    if (method.toUpperCase() === 'POST') {\n      const formData = new FormData()\n      Object.entries(fields).forEach(([key, value]) => formData.set(key, value))\n      formData.set('file', data)\n      body = formData\n    } else {\n      body = data\n    }\n\n    const { onProgress, onComplete } = chunk\n\n    const result = await this.#uploadPartBytes({\n      signature: { url, headers, method },\n      body,\n      size: data.size,\n      onProgress,\n      onComplete,\n      signal,\n    }).abortOn(signal)\n\n    return 'location' in result ? result : {\n      location: removeMetadataFromURL(url),\n      ...result,\n    }\n  }\n\n  /**\n   * @param {import(\"@uppy/core\").UppyFile} file\n   * @param {import(\"../types/chunk\").Chunk[]} chunks\n   * @param {AbortSignal} signal\n   * @returns {Promise<void>}\n   */\n  async uploadFile (file, chunks, signal) {\n    throwIfAborted(signal)\n    if (chunks.length === 1 && !chunks[0].shouldUseMultipart) {\n      return this.#nonMultipartUpload(file, chunks[0], signal)\n    }\n    const { uploadId, key } = await this.getUploadId(file, signal)\n    throwIfAborted(signal)\n    try {\n      const parts = await Promise.all(chunks.map((chunk, i) => this.uploadChunk(file, i + 1, chunk, signal)))\n      throwIfAborted(signal)\n      return await this.#sendCompletionRequest(\n        this.#getFile(file),\n        { key, uploadId, parts, signal },\n        signal,\n      ).abortOn(signal)\n    } catch (err) {\n      if (err?.cause !== pausingUploadReason && err?.name !== 'AbortError') {\n        // We purposefully don't wait for the promise and ignore its status,\n        // because we want the error `err` to bubble up ASAP to report it to the\n        // user. A failure to abort is not that big of a deal anyway.\n        this.abortFileUpload(file)\n      }\n      throw err\n    }\n  }\n\n  restoreUploadFile (file, uploadIdAndKey) {\n    this.#cache.set(file.data, uploadIdAndKey)\n  }\n\n  async resumeUploadFile (file, chunks, signal) {\n    throwIfAborted(signal)\n    if (chunks.length === 1 && chunks[0] != null && !chunks[0].shouldUseMultipart) {\n      return this.#nonMultipartUpload(file, chunks[0], signal)\n    }\n    const { uploadId, key } = await this.getUploadId(file, signal)\n    throwIfAborted(signal)\n    const alreadyUploadedParts = await this.#listParts(\n      this.#getFile(file),\n      { uploadId, key, signal },\n      signal,\n    ).abortOn(signal)\n    throwIfAborted(signal)\n    const parts = await Promise.all(\n      chunks\n        .map((chunk, i) => {\n          const partNumber = i + 1\n          const alreadyUploadedInfo = alreadyUploadedParts.find(({ PartNumber }) => PartNumber === partNumber)\n          if (alreadyUploadedInfo == null) {\n            return this.uploadChunk(file, partNumber, chunk, signal)\n          }\n          // Already uploaded chunks are set to null. If we are restoring the upload, we need to mark it as already uploaded.\n          chunk?.setAsUploaded?.()\n          return { PartNumber: partNumber, ETag: alreadyUploadedInfo.ETag }\n        }),\n    )\n    throwIfAborted(signal)\n    return this.#sendCompletionRequest(\n      this.#getFile(file),\n      { key, uploadId, parts, signal },\n      signal,\n    ).abortOn(signal)\n  }\n\n  /**\n   *\n   * @param {import(\"@uppy/core\").UppyFile} file\n   * @param {number} partNumber\n   * @param {import(\"../types/chunk\").Chunk} chunk\n   * @param {AbortSignal} signal\n   * @returns {Promise<object>}\n   */\n  async uploadChunk (file, partNumber, chunk, signal) {\n    throwIfAborted(signal)\n    const { uploadId, key } = await this.getUploadId(file, signal)\n\n    const signatureRetryIterator = this.#retryDelays.values()\n    const chunkRetryIterator = this.#retryDelays.values()\n    const shouldRetrySignature = () => {\n      const next = signatureRetryIterator.next()\n      if (next == null || next.done) {\n        return null\n      }\n      return next.value\n    }\n\n    for (;;) {\n      throwIfAborted(signal)\n      const chunkData = chunk.getData()\n      const { onProgress, onComplete } = chunk\n      let signature\n\n      try {\n        signature = await this.#fetchSignature(this.#getFile(file), {\n          uploadId, key, partNumber, body: chunkData, signal,\n        }).abortOn(signal)\n      } catch (err) {\n        const timeout = shouldRetrySignature()\n        if (timeout == null || signal.aborted) {\n          throw err\n        }\n        await new Promise(resolve => setTimeout(resolve, timeout))\n        // eslint-disable-next-line no-continue\n        continue\n      }\n\n      throwIfAborted(signal)\n      try {\n        return {\n          PartNumber: partNumber,\n          ...await this.#uploadPartBytes({\n            signature, body: chunkData, size: chunkData.size, onProgress, onComplete, signal,\n          }).abortOn(signal),\n        }\n      } catch (err) {\n        if (!await this.#shouldRetry(err, chunkRetryIterator)) throw err\n      }\n    }\n  }\n}\n\nexport default class AwsS3Multipart extends BasePlugin {\n  static VERSION = packageJson.version\n\n  #companionCommunicationQueue\n\n  #client\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.type = 'uploader'\n    this.id = this.opts.id || 'AwsS3Multipart'\n    this.title = 'AWS S3 Multipart'\n    this.#client = new RequestClient(uppy, opts)\n\n    const defaultOptions = {\n      // TODO: null here means “include all”, [] means include none.\n      // This is inconsistent with @uppy/aws-s3 and @uppy/transloadit\n      allowedMetaFields: null,\n      limit: 6,\n      shouldUseMultipart: (file) => file.size !== 0, // TODO: Switch default to:\n      // eslint-disable-next-line no-bitwise\n      // shouldUseMultipart: (file) => file.size >> 10 >> 10 > 100,\n      retryDelays: [0, 1000, 3000, 5000],\n      createMultipartUpload: this.createMultipartUpload.bind(this),\n      listParts: this.listParts.bind(this),\n      abortMultipartUpload: this.abortMultipartUpload.bind(this),\n      completeMultipartUpload: this.completeMultipartUpload.bind(this),\n      getTemporarySecurityCredentials: false,\n      signPart: opts?.getTemporarySecurityCredentials ? this.createSignedURL.bind(this) : this.signPart.bind(this),\n      uploadPartBytes: AwsS3Multipart.uploadPartBytes,\n      getUploadParameters: opts?.getTemporarySecurityCredentials\n        ? this.createSignedURL.bind(this)\n        : this.getUploadParameters.bind(this),\n      companionHeaders: {},\n    }\n\n    this.opts = { ...defaultOptions, ...opts }\n    if (opts?.prepareUploadParts != null && opts.signPart == null) {\n      this.opts.signPart = async (file, { uploadId, key, partNumber, body, signal }) => {\n        const { presignedUrls, headers } = await opts\n          .prepareUploadParts(file, { uploadId, key, parts: [{ number: partNumber, chunk: body }], signal })\n        return { url: presignedUrls?.[partNumber], headers: headers?.[partNumber] }\n      }\n    }\n\n    /**\n     * Simultaneous upload limiting is shared across all uploads with this plugin.\n     *\n     * @type {RateLimitedQueue}\n     */\n    this.requests = this.opts.rateLimitedQueue ?? new RateLimitedQueue(this.opts.limit)\n    this.#companionCommunicationQueue = new HTTPCommunicationQueue(\n      this.requests,\n      this.opts,\n      this.#setS3MultipartState,\n      this.#getFile,\n    )\n\n    this.uploaders = Object.create(null)\n    this.uploaderEvents = Object.create(null)\n    this.uploaderSockets = Object.create(null)\n  }\n\n  [Symbol.for('uppy test: getClient')] () { return this.#client }\n\n  setOptions (newOptions) {\n    this.#companionCommunicationQueue.setOptions(newOptions)\n    super.setOptions(newOptions)\n    this.#setCompanionHeaders()\n  }\n\n  /**\n   * Clean up all references for a file's upload: the MultipartUploader instance,\n   * any events related to the file, and the Companion WebSocket connection.\n   *\n   * Set `opts.abort` to tell S3 that the multipart upload is cancelled and must be removed.\n   * This should be done when the user cancels the upload, not when the upload is completed or errored.\n   */\n  resetUploaderReferences (fileID, opts = {}) {\n    if (this.uploaders[fileID]) {\n      this.uploaders[fileID].abort({ really: opts.abort || false })\n      this.uploaders[fileID] = null\n    }\n    if (this.uploaderEvents[fileID]) {\n      this.uploaderEvents[fileID].remove()\n      this.uploaderEvents[fileID] = null\n    }\n    if (this.uploaderSockets[fileID]) {\n      this.uploaderSockets[fileID].close()\n      this.uploaderSockets[fileID] = null\n    }\n  }\n\n  // TODO: make this a private method in the next major\n  assertHost (method) {\n    if (!this.opts.companionUrl) {\n      throw new Error(`Expected a \\`companionUrl\\` option containing a Companion address, or if you are not using Companion, a custom \\`${method}\\` implementation.`)\n    }\n  }\n\n  async createMultipartUpload (file, signal) {\n    this.assertHost('createMultipartUpload')\n    throwIfAborted(signal)\n\n    const metadata = getAllowedMetadata({ meta: file.meta, allowedMetaFields: this.opts.allowedMetaFields })\n\n    const idToken = await auth.currentUser.getIdToken(true);\n    return this.#client.post('s3/multipart', {\n      filename: file.name,\n      idToken,\n      type: file.type,\n      metadata: removeMetaProperty(metadata),\n    }, { signal }).then(assertServerError)\n  }\n\n  listParts (file, { key, uploadId }, signal) {\n    this.assertHost('listParts')\n    throwIfAborted(signal)\n\n    const filename = encodeURIComponent(key)\n    return this.#client.get(`s3/multipart/${uploadId}?key=${filename}`, { signal })\n      .then(assertServerError)\n  }\n\n  completeMultipartUpload (file, { key, uploadId, parts }, signal) {\n    this.assertHost('completeMultipartUpload')\n    throwIfAborted(signal)\n\n    const filename = encodeURIComponent(key)\n    const uploadIdEnc = encodeURIComponent(uploadId)\n    return this.#client.post(`s3/multipart/${uploadIdEnc}/complete?key=${filename}`, { parts }, { signal })\n      .then(assertServerError)\n  }\n\n  /**\n   * @type {import(\"../types\").AwsS3STSResponse | Promise<import(\"../types\").AwsS3STSResponse>}\n   */\n  #cachedTemporaryCredentials\n\n  async #getTemporarySecurityCredentials (options) {\n    throwIfAborted(options?.signal)\n\n    if (this.#cachedTemporaryCredentials == null) {\n      // We do not await it just yet, so concurrent calls do not try to override it:\n      if (this.opts.getTemporarySecurityCredentials === true) {\n        this.assertHost('getTemporarySecurityCredentials')\n        this.#cachedTemporaryCredentials = this.#client.get('s3/sts', null, options).then(assertServerError)\n      } else {\n        this.#cachedTemporaryCredentials = this.opts.getTemporarySecurityCredentials(options)\n      }\n      this.#cachedTemporaryCredentials = await this.#cachedTemporaryCredentials\n      setTimeout(() => {\n        // At half the time left before expiration, we clear the cache. That's\n        // an arbitrary tradeoff to limit the number of requests made to the\n        // remote while limiting the risk of using an expired token in case the\n        // clocks are not exactly synced.\n        // The HTTP cache should be configured to ensure a client doesn't request\n        // more tokens than it needs, but this timeout provides a second layer of\n        // security in case the HTTP cache is disabled or misconfigured.\n        this.#cachedTemporaryCredentials = null\n      }, (getExpiry(this.#cachedTemporaryCredentials.credentials) || 0) * 500)\n    }\n\n    return this.#cachedTemporaryCredentials\n  }\n\n  async createSignedURL (file, options) {\n    const data = await this.#getTemporarySecurityCredentials(options)\n    const expires = getExpiry(data.credentials) || 604_800 // 604 800 is the max value accepted by AWS.\n\n    const { uploadId, key, partNumber, signal } = options\n\n    // Return an object in the correct shape.\n    return {\n      method: 'PUT',\n      expires,\n      fields: {},\n      url: `${await createSignedURL({\n        accountKey: data.credentials.AccessKeyId,\n        accountSecret: data.credentials.SecretAccessKey,\n        sessionToken: data.credentials.SessionToken,\n        expires,\n        bucketName: data.bucket,\n        Region: data.region,\n        Key: key ?? `${crypto.randomUUID()}-${file.name}`,\n        uploadId,\n        partNumber,\n        signal,\n      })}`,\n      // Provide content type header required by S3\n      headers: {\n        'Content-Type': file.type,\n      },\n    }\n  }\n\n  signPart (file, { uploadId, key, partNumber, signal }) {\n    this.assertHost('signPart')\n    throwIfAborted(signal)\n\n    if (uploadId == null || key == null || partNumber == null) {\n      throw new Error('Cannot sign without a key, an uploadId, and a partNumber')\n    }\n\n    const filename = encodeURIComponent(key)\n    return this.#client.get(`s3/multipart/${uploadId}/${partNumber}?key=${filename}`, { signal })\n      .then(assertServerError)\n  }\n\n  abortMultipartUpload (file, { key, uploadId }, signal) {\n    this.assertHost('abortMultipartUpload')\n\n    const filename = encodeURIComponent(key)\n    const uploadIdEnc = encodeURIComponent(uploadId)\n    return this.#client.delete(`s3/multipart/${uploadIdEnc}?key=${filename}`, undefined, { signal })\n      .then(assertServerError)\n  }\n\n  getUploadParameters (file, options) {\n    const { meta } = file\n    const { type, name: filename } = meta\n    const metadata = getAllowedMetadata({ meta, allowedMetaFields: this.opts.allowedMetaFields, querify: true })\n\n    const query = new URLSearchParams({ filename, type, ...metadata })\n\n    return this.#client.get(`s3/params?${query}`, options)\n  }\n\n  static async uploadPartBytes ({ signature: { url, expires, headers, method = 'PUT' }, body, size = body.size, onProgress, onComplete, signal }) {\n    throwIfAborted(signal)\n\n    if (url == null) {\n      throw new Error('Cannot upload to an undefined URL')\n    }\n\n    return new Promise((resolve, reject) => {\n      const xhr = new XMLHttpRequest()\n      xhr.open(method, url, true)\n      if (headers) {\n        Object.keys(headers).forEach((key) => {\n          xhr.setRequestHeader(key, headers[key])\n        })\n      }\n      xhr.responseType = 'text'\n      if (typeof expires === 'number') {\n        xhr.timeout = expires * 1000\n      }\n\n      function onabort () {\n        xhr.abort()\n      }\n      function cleanup () {\n        signal.removeEventListener('abort', onabort)\n      }\n      signal.addEventListener('abort', onabort)\n\n      xhr.upload.addEventListener('progress', (ev) => {\n        onProgress(ev)\n      })\n\n      xhr.addEventListener('abort', () => {\n        cleanup()\n\n        reject(createAbortError())\n      })\n\n      xhr.addEventListener('timeout', () => {\n        cleanup()\n\n        const error = new Error('Request has expired')\n        error.source = { status: 403 }\n        reject(error)\n      })\n      xhr.addEventListener('load', (ev) => {\n        cleanup()\n\n        if (ev.target.status === 403 && ev.target.responseText.includes('<Message>Request has expired</Message>')) {\n          const error = new Error('Request has expired')\n          error.source = ev.target\n          reject(error)\n          return\n        } if (ev.target.status < 200 || ev.target.status >= 300) {\n          const error = new Error('Non 2xx')\n          error.source = ev.target\n          reject(error)\n          return\n        }\n\n        // todo make a proper onProgress API (breaking change)\n        onProgress?.({ loaded: size, lengthComputable: true })\n\n        // NOTE This must be allowed by CORS.\n        const etag = ev.target.getResponseHeader('ETag')\n        const location = ev.target.getResponseHeader('Location')\n\n        if (method.toUpperCase() === 'POST' && location === null) {\n          // Not being able to read the Location header is not a fatal error.\n          // eslint-disable-next-line no-console\n          console.warn('AwsS3/Multipart: Could not read the Location header. This likely means CORS is not configured correctly on the S3 Bucket. See https://uppy.io/docs/aws-s3-multipart#S3-Bucket-Configuration for instructions.')\n        }\n        if (etag === null) {\n          reject(new Error('AwsS3/Multipart: Could not read the ETag header. This likely means CORS is not configured correctly on the S3 Bucket. See https://uppy.io/docs/aws-s3-multipart#S3-Bucket-Configuration for instructions.'))\n          return\n        }\n\n        onComplete?.(etag)\n        resolve({\n          ETag: etag,\n          ...(location ? { location } : undefined),\n        })\n      })\n\n      xhr.addEventListener('error', (ev) => {\n        cleanup()\n\n        const error = new Error('Unknown error')\n        error.source = ev.target\n        reject(error)\n      })\n\n      xhr.send(body)\n    })\n  }\n\n  #setS3MultipartState = (file, { key, uploadId }) => {\n    const cFile = this.uppy.getFile(file.id)\n    if (cFile == null) {\n      // file was removed from store\n      return\n    }\n\n    this.uppy.setFileState(file.id, {\n      s3Multipart: {\n        ...cFile.s3Multipart,\n        key,\n        uploadId,\n      },\n    })\n  }\n\n  #getFile = (file) => {\n    return this.uppy.getFile(file.id) || file\n  }\n\n  #uploadLocalFile (file) {\n    return new Promise((resolve, reject) => {\n      const onProgress = (bytesUploaded, bytesTotal) => {\n        this.uppy.emit('upload-progress', file, {\n          uploader: this,\n          bytesUploaded,\n          bytesTotal,\n        })\n      }\n\n      const onError = (err) => {\n        this.uppy.log(err)\n        this.uppy.emit('upload-error', file, err)\n\n        this.resetUploaderReferences(file.id)\n        reject(err)\n      }\n\n      const onSuccess = (result) => {\n        const uploadResp = {\n          body: {\n            ...result,\n          },\n          uploadURL: result.location,\n        }\n\n        this.resetUploaderReferences(file.id)\n\n        this.uppy.emit('upload-success', this.#getFile(file), uploadResp)\n\n        if (result.location) {\n          this.uppy.log(`Download ${file.name} from ${result.location}`)\n        }\n\n        resolve()\n      }\n\n      const onPartComplete = (part) => {\n        this.uppy.emit('s3-multipart:part-uploaded', this.#getFile(file), part)\n      }\n\n      const upload = new MultipartUploader(file.data, {\n        // .bind to pass the file object to each handler.\n        companionComm: this.#companionCommunicationQueue,\n\n        log: (...args) => this.uppy.log(...args),\n        getChunkSize: this.opts.getChunkSize ? this.opts.getChunkSize.bind(this) : null,\n\n        onProgress,\n        onError,\n        onSuccess,\n        onPartComplete,\n\n        file,\n        shouldUseMultipart: this.opts.shouldUseMultipart,\n\n        ...file.s3Multipart,\n      })\n\n      this.uploaders[file.id] = upload\n      const eventManager = new EventManager(this.uppy)\n      this.uploaderEvents[file.id] = eventManager\n\n      eventManager.onFileRemove(file.id, (removed) => {\n        upload.abort()\n        this.resetUploaderReferences(file.id, { abort: true })\n        resolve(`upload ${removed.id} was removed`)\n      })\n\n      eventManager.onCancelAll(file.id, ({ reason } = {}) => {\n        if (reason === 'user') {\n          upload.abort()\n          this.resetUploaderReferences(file.id, { abort: true })\n        }\n        resolve(`upload ${file.id} was canceled`)\n      })\n\n      eventManager.onFilePause(file.id, (isPaused) => {\n        if (isPaused) {\n          upload.pause()\n        } else {\n          upload.start()\n        }\n      })\n\n      eventManager.onPauseAll(file.id, () => {\n        upload.pause()\n      })\n\n      eventManager.onResumeAll(file.id, () => {\n        upload.start()\n      })\n\n      upload.start()\n    })\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  #getCompanionClientArgs (file) {\n    return {\n      ...file.remote.body,\n      protocol: 's3-multipart',\n      size: file.data.size,\n      metadata: removeMetaProperty(file.meta)\n    }\n  }\n\n  #upload = async (fileIDs) => {\n    if (fileIDs.length === 0) return undefined\n\n    const files = this.uppy.getFilesByIds(fileIDs)\n    const filesFiltered = filterNonFailedFiles(files)\n    const filesToEmit = filterFilesToEmitUploadStarted(filesFiltered)\n\n    this.uppy.emit('upload-start', filesToEmit)\n\n    const promises = filesFiltered.map((file) => {\n      if (file.isRemote) {\n        const getQueue = () => this.requests\n        this.#setResumableUploadsCapability(false)\n        const controller = new AbortController()\n\n        const removedHandler = (removedFile) => {\n          if (removedFile.id === file.id) controller.abort()\n        }\n        this.uppy.on('file-removed', removedHandler)\n\n        const uploadPromise = file.remote.requestClient.uploadRemoteFile(\n          file,\n          this.#getCompanionClientArgs(file),\n          { signal: controller.signal, getQueue },\n        )\n\n        this.requests.wrapSyncFunction(() => {\n          this.uppy.off('file-removed', removedHandler)\n        }, { priority: -1 })()\n\n        return uploadPromise\n      }\n\n      return this.#uploadLocalFile(file)\n    })\n\n    const upload = await Promise.all(promises)\n    // After the upload is done, another upload may happen with only local files.\n    // We reset the capability so that the next upload can use resumable uploads.\n    this.#setResumableUploadsCapability(true)\n    return upload\n  }\n\n  #setCompanionHeaders = () => {\n    this.#client.setCompanionHeaders(this.opts.companionHeaders)\n  }\n\n  #setResumableUploadsCapability = (boolean) => {\n    const { capabilities } = this.uppy.getState()\n    this.uppy.setState({\n      capabilities: {\n        ...capabilities,\n        resumableUploads: boolean,\n      },\n    })\n  }\n\n  #resetResumableCapability = () => {\n    this.#setResumableUploadsCapability(true)\n  }\n\n  install () {\n    this.#setResumableUploadsCapability(true)\n    this.uppy.addPreProcessor(this.#setCompanionHeaders)\n    this.uppy.addUploader(this.#upload)\n    this.uppy.on('cancel-all', this.#resetResumableCapability)\n  }\n\n  uninstall () {\n    this.uppy.removePreProcessor(this.#setCompanionHeaders)\n    this.uppy.removeUploader(this.#upload)\n    this.uppy.off('cancel-all', this.#resetResumableCapability)\n  }\n}\n"],"mappings":"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"}