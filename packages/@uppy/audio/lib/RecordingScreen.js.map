{"version":3,"names":["h","useEffect","useRef","RecordButton","RecordingLength","AudioSourceSelect","AudioOscilloscope","SubmitButton","DiscardButton","RecordingScreen","props","stream","recordedAudio","onStop","recording","supportsRecording","audioSources","showAudioSourceDropdown","onSubmit","i18n","onStartRecording","onStopRecording","onDiscardRecordedAudio","recordingLengthSeconds","canvasEl","oscilloscope","current","canvas","width","height","canvasContext","lineWidth","fillStyle","strokeStyle","draw","audioContext","AudioContext","source","createMediaStreamSource","addSource","hasRecordedAudio","shouldShowRecordButton","shouldShowAudioSourceDropdown","length","className","controls","src","ref","onDiscard"],"sources":["RecordingScreen.jsx"],"sourcesContent":["/* eslint-disable jsx-a11y/media-has-caption */\nimport { h } from 'preact'\nimport { useEffect, useRef } from 'preact/hooks'\nimport RecordButton from './RecordButton.jsx'\nimport RecordingLength from './RecordingLength.jsx'\nimport AudioSourceSelect from './AudioSourceSelect.jsx'\nimport AudioOscilloscope from './audio-oscilloscope/index.js'\nimport SubmitButton from './SubmitButton.jsx'\nimport DiscardButton from './DiscardButton.jsx'\n\nexport default function RecordingScreen (props) {\n  const {\n    stream,\n    recordedAudio,\n    onStop,\n    recording,\n    supportsRecording,\n    audioSources,\n    showAudioSourceDropdown,\n    onSubmit,\n    i18n,\n    onStartRecording,\n    onStopRecording,\n    onDiscardRecordedAudio,\n    recordingLengthSeconds,\n  } = props\n\n  const canvasEl = useRef(null)\n  const oscilloscope = useRef(null)\n\n  // componentDidMount / componentDidUnmount\n  useEffect(() => {\n    return () => {\n      oscilloscope.current = null\n      onStop()\n    }\n  }, [onStop])\n\n  // componentDidUpdate\n  useEffect(() => {\n    if (!recordedAudio) {\n      oscilloscope.current = new AudioOscilloscope(canvasEl.current, {\n        canvas: {\n          width: 600,\n          height: 600,\n        },\n        canvasContext: {\n          lineWidth: 2,\n          fillStyle: 'rgb(0,0,0)',\n          strokeStyle: 'green',\n        },\n      })\n      oscilloscope.current.draw()\n\n      if (stream) {\n        const audioContext = new AudioContext()\n        const source = audioContext.createMediaStreamSource(stream)\n        oscilloscope.current.addSource(source)\n      }\n    }\n  }, [recordedAudio, stream])\n\n  const hasRecordedAudio = recordedAudio != null\n  const shouldShowRecordButton = !hasRecordedAudio && supportsRecording\n  const shouldShowAudioSourceDropdown = showAudioSourceDropdown\n    && !hasRecordedAudio\n    && audioSources\n    && audioSources.length > 1\n\n  return (\n    <div className=\"uppy-Audio-container\">\n      <div className=\"uppy-Audio-audioContainer\">\n        {hasRecordedAudio\n          ? (\n            <audio\n              className=\"uppy-Audio-player\"\n              controls\n              src={recordedAudio}\n            />\n          ) : (\n            <canvas\n              ref={canvasEl}\n              className=\"uppy-Audio-canvas\"\n            />\n          )}\n      </div>\n      <div className=\"uppy-Audio-footer\">\n        <div className=\"uppy-Audio-audioSourceContainer\">\n          {shouldShowAudioSourceDropdown\n            ? AudioSourceSelect(props)\n            : null}\n        </div>\n        <div className=\"uppy-Audio-buttonContainer\">\n          {shouldShowRecordButton && (\n            <RecordButton\n              recording={recording}\n              onStartRecording={onStartRecording}\n              onStopRecording={onStopRecording}\n              i18n={i18n}\n            />\n          )}\n\n          {hasRecordedAudio && <SubmitButton onSubmit={onSubmit} i18n={i18n} />}\n\n          {hasRecordedAudio && <DiscardButton onDiscard={onDiscardRecordedAudio} i18n={i18n} />}\n        </div>\n\n        <div className=\"uppy-Audio-recordingLength\">\n          {!hasRecordedAudio && (\n            <RecordingLength recordingLengthSeconds={recordingLengthSeconds} i18n={i18n} />\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"mappings":"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"}