{"version":3,"names":["isFunction","v","result","_draw","_classPrivateFieldLooseKey","AudioOscilloscope","constructor","canvas","options","Object","defineProperty","writable","value","draw","canvasOptions","canvasContextOptions","canvasContext","analyser","bufferLength","dataArray","width","height","getContext","fillStyle","strokeStyle","lineWidth","onDrawFrame","addSource","streamSource","audioContext","context","createAnalyser","fftSize","frequencyBinCount","source","createBufferSource","Uint8Array","getByteTimeDomainData","connect","ctx","w","h","fillRect","beginPath","sliceWidth","x","moveTo","i","y","lineTo","stroke","requestAnimationFrame","_classPrivateFieldLooseBase"],"sources":["index.js"],"sourcesContent":["function isFunction (v) {\n  return typeof v === 'function'\n}\n\nfunction result (v) {\n  return isFunction(v) ? v() : v\n}\n\n/* Audio Oscilloscope\n  https://github.com/miguelmota/audio-oscilloscope\n*/\nexport default class AudioOscilloscope {\n  constructor (canvas, options = {}) {\n    const canvasOptions = options.canvas || {}\n    const canvasContextOptions = options.canvasContext || {}\n    this.analyser = null\n    this.bufferLength = 0\n    this.dataArray = []\n    this.canvas = canvas\n    this.width = result(canvasOptions.width) || this.canvas.width\n    this.height = result(canvasOptions.height) || this.canvas.height\n    this.canvas.width = this.width\n    this.canvas.height = this.height\n    this.canvasContext = this.canvas.getContext('2d')\n    this.canvasContext.fillStyle = result(canvasContextOptions.fillStyle) || 'rgb(255, 255, 255)'\n    this.canvasContext.strokeStyle = result(canvasContextOptions.strokeStyle) || 'rgb(0, 0, 0)'\n    this.canvasContext.lineWidth = result(canvasContextOptions.lineWidth) || 1\n    this.onDrawFrame = isFunction(options.onDrawFrame) ? options.onDrawFrame : () => {}\n  }\n\n  addSource (streamSource) {\n    this.streamSource = streamSource\n    this.audioContext = this.streamSource.context\n    this.analyser = this.audioContext.createAnalyser()\n    this.analyser.fftSize = 2048\n    this.bufferLength = this.analyser.frequencyBinCount\n    this.source = this.audioContext.createBufferSource()\n    this.dataArray = new Uint8Array(this.bufferLength)\n    this.analyser.getByteTimeDomainData(this.dataArray)\n    this.streamSource.connect(this.analyser)\n  }\n\n  draw () {\n    const { analyser, dataArray, bufferLength } = this\n    const ctx = this.canvasContext\n    const w = this.width\n    const h = this.height\n\n    if (analyser) {\n      analyser.getByteTimeDomainData(dataArray)\n    }\n\n    ctx.fillRect(0, 0, w, h)\n    ctx.beginPath()\n\n    const sliceWidth = (w * 1.0) / bufferLength\n    let x = 0\n\n    if (!bufferLength) {\n      ctx.moveTo(0, this.height / 2)\n    }\n\n    for (let i = 0; i < bufferLength; i++) {\n      const v = dataArray[i] / 128.0\n      const y = v * (h / 2)\n\n      if (i === 0) {\n        ctx.moveTo(x, y)\n      } else {\n        ctx.lineTo(x, y)\n      }\n\n      x += sliceWidth\n    }\n\n    ctx.lineTo(w, h / 2)\n    ctx.stroke()\n\n    this.onDrawFrame(this)\n    requestAnimationFrame(this.#draw)\n  }\n\n  #draw = () => this.draw()\n}\n"],"mappings":"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"}